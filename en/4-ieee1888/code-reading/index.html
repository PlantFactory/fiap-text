
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Description temp_upload Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../extending-temp-upload/" />
    
    
    <link rel="prev" href="../getting-started/" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../1-install-arduino/">
            
                <a href="../../1-install-arduino/">
            
                    
                    Install Arduino
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../2-m2m-gateway-prepare/">
            
                <a href="../../2-m2m-gateway-prepare/">
            
                    
                    M2M Gateway preparation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../3-arduino-fundamentals/">
            
                <a href="../../3-arduino-fundamentals/">
            
                    
                    Arduino Fundamentals
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../3-arduino-fundamentals/blink/">
            
                <a href="../../3-arduino-fundamentals/blink/">
            
                    
                    LED Blink
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../../3-arduino-fundamentals/digital/">
            
                <a href="../../3-arduino-fundamentals/digital/">
            
                    
                    Digital Input / output
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../../3-arduino-fundamentals/analog/">
            
                <a href="../../3-arduino-fundamentals/analog/">
            
                    
                    Analog Output
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../../3-arduino-fundamentals/using-libraries/">
            
                <a href="../../3-arduino-fundamentals/using-libraries/">
            
                    
                    Using libraries
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../../3-arduino-fundamentals/serial/">
            
                <a href="../../3-arduino-fundamentals/serial/">
            
                    
                    Serial
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../../3-arduino-fundamentals/wire/">
            
                <a href="../../3-arduino-fundamentals/wire/">
            
                    
                    I2C(Wire)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../../3-arduino-fundamentals/adt74x0/">
            
                <a href="../../3-arduino-fundamentals/adt74x0/">
            
                    
                    ADT74x0(Temperature Sensor)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../../3-arduino-fundamentals/fiapupload/">
            
                <a href="../../3-arduino-fundamentals/fiapupload/">
            
                    
                    FIAPUploadAgent
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../../3-arduino-fundamentals/time/">
            
                <a href="../../3-arduino-fundamentals/time/">
            
                    
                    Time
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="../../3-arduino-fundamentals/localtime/">
            
                <a href="../../3-arduino-fundamentals/localtime/">
            
                    
                    LocalTimeLib
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.11" data-path="../../3-arduino-fundamentals/ntp/">
            
                <a href="../../3-arduino-fundamentals/ntp/">
            
                    
                    NTP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.12" data-path="../../3-arduino-fundamentals/serialcli/">
            
                <a href="../../3-arduino-fundamentals/serialcli/">
            
                    
                    SerialCLI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.13" data-path="../../3-arduino-fundamentals/dtostrf/">
            
                <a href="../../3-arduino-fundamentals/dtostrf/">
            
                    
                    Convert floating point a character string(dtostrf)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.14" data-path="../../3-arduino-fundamentals/schedule/">
            
                <a href="../../3-arduino-fundamentals/schedule/">
            
                    
                    Run every n seconds
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.15" data-path="../../3-arduino-fundamentals/moving-average/">
            
                <a href="../../3-arduino-fundamentals/moving-average/">
            
                    
                    Moving Average
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../">
            
                <a href="../">
            
                    
                    IEEE1888(FIAP)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../keywords/">
            
                <a href="../keywords/">
            
                    
                    Keywords
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../getting-started/">
            
                <a href="../getting-started/">
            
                    
                    Upload from M2M gateway
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5.3" data-path="./">
            
                <a href="./">
            
                    
                    Description temp_upload
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../extending-temp-upload/">
            
                <a href="../extending-temp-upload/">
            
                    
                    Extend temp_upload
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Description temp_upload</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="explanation-of-tempupload">Explanation of temp_upload</h2>
<h3 id="dependent-library">Dependent Library</h3>
<p>Explanation for each library is in <a href="../../3-arduino-fundamentals/">Arduino fundamentals</a></p>
<ul>
<li><a href="https://github.com/PlantFactory/PFFIAPUploadAgent" target="_blank">PFFIAPUploadAgent</a></li>
<li><a href="https://github.com/PaulStoffregen/Time" target="_blank">Time</a></li>
<li><a href="https://github.com/PlantFactory/LocalTimeLib" target="_blank">LocalTimeLib</a></li>
<li><a href="https://github.com/PlantFactory/SerialCLI" target="_blank">SerialCLI</a></li>
<li><a href="https://github.com/PlantFactory/NTP" target="_blank">NTP</a></li>
<li><a href="https://github.com/PlantFactory/ADT74x0" target="_blank">ADT74x0</a></li>
</ul>
<h3 id="source-code-description">Source code description</h3>
<h4 id="instance-declaration">Instance declaration</h4>
<p>Arduino has RAM that is capable about 2KB to 8KB&#xFF0C;which is less than a laptop. Also, as the processing power is not so high, we do not recommend creating or discarding instances frequently.
Therefore, <code>temp_upload</code> creates an instance as a global variable&#xFF0E;</p>
<p>SerialCLI declaration, communication interface uses Serial.</p>
<pre><code class="lang-C++"><span class="hljs-comment">//cli</span>
<span class="hljs-function">SerialCLI      <span class="hljs-title">commandline</span><span class="hljs-params">(Serial)</span></span>;
</code></pre>
<p>See <a href="4-ieee1888/getting-started/README.md">Upload from M2M Gateway</a>for configuration parameters and explaination.</p>
<pre><code class="lang-C++"><span class="hljs-comment">//  ethernet</span>
<span class="hljs-function">MacEntry       <span class="hljs-title">mac</span><span class="hljs-params">(<span class="hljs-string">&quot;MAC&quot;</span>, <span class="hljs-string">&quot;01:23:45:67:89:AB&quot;</span>, <span class="hljs-string">&quot;mac address&quot;</span>)</span></span>;
<span class="hljs-comment">//  ip</span>
<span class="hljs-function">BoolEntry      <span class="hljs-title">dhcp</span><span class="hljs-params">(<span class="hljs-string">&quot;DHCP&quot;</span>, <span class="hljs-string">&quot;true&quot;</span>, <span class="hljs-string">&quot;DHCP enable/disable&quot;</span>)</span></span>;
<span class="hljs-function">IPAddressEntry <span class="hljs-title">ip</span><span class="hljs-params">(<span class="hljs-string">&quot;IP&quot;</span>, <span class="hljs-string">&quot;192.168.0.2&quot;</span>, <span class="hljs-string">&quot;IP address&quot;</span>)</span></span>;
<span class="hljs-function">IPAddressEntry <span class="hljs-title">gw</span><span class="hljs-params">(<span class="hljs-string">&quot;GW&quot;</span>, <span class="hljs-string">&quot;192.168.0.1&quot;</span>, <span class="hljs-string">&quot;default gateway IP address&quot;</span>)</span></span>;
<span class="hljs-function">IPAddressEntry <span class="hljs-title">sm</span><span class="hljs-params">(<span class="hljs-string">&quot;SM&quot;</span>, <span class="hljs-string">&quot;255.255.255.0&quot;</span>, <span class="hljs-string">&quot;subnet mask&quot;</span>)</span></span>;
<span class="hljs-function">IPAddressEntry <span class="hljs-title">dns_server</span><span class="hljs-params">(<span class="hljs-string">&quot;DNS&quot;</span>, <span class="hljs-string">&quot;8.8.8.8&quot;</span>, <span class="hljs-string">&quot;dns server&quot;</span>)</span></span>;
<span class="hljs-comment">//  ntp</span>
<span class="hljs-function">StringEntry    <span class="hljs-title">ntp</span><span class="hljs-params">(<span class="hljs-string">&quot;NTP&quot;</span>, <span class="hljs-string">&quot;ntp.nict.jp&quot;</span>, <span class="hljs-string">&quot;ntp server&quot;</span>)</span></span>;
<span class="hljs-comment">//  fiap</span>
<span class="hljs-function">StringEntry    <span class="hljs-title">host</span><span class="hljs-params">(<span class="hljs-string">&quot;HOST&quot;</span>, <span class="hljs-string">&quot;fiap-dev.gutp.ic.i.u-tokyo.ac.jp&quot;</span>, <span class="hljs-string">&quot;host of ieee1888 server end point&quot;</span>)</span></span>;
<span class="hljs-function">IntegerEntry   <span class="hljs-title">port</span><span class="hljs-params">(<span class="hljs-string">&quot;PORT&quot;</span>, <span class="hljs-string">&quot;80&quot;</span>, <span class="hljs-string">&quot;port of ieee1888 server end point&quot;</span>)</span></span>;
<span class="hljs-function">StringEntry    <span class="hljs-title">path</span><span class="hljs-params">(<span class="hljs-string">&quot;PATH&quot;</span>, <span class="hljs-string">&quot;/axis2/services/FIAPStorage&quot;</span>, <span class="hljs-string">&quot;path of ieee1888 server end point&quot;</span>)</span></span>;
<span class="hljs-function">StringEntry    <span class="hljs-title">prefix</span><span class="hljs-params">(<span class="hljs-string">&quot;PREFIX&quot;</span>, <span class="hljs-string">&quot;http://taisyo.hongo.wide.ad.jp/MyHome/Node1/&quot;</span>, <span class="hljs-string">&quot;prefix of point id&quot;</span>)</span></span>;
</code></pre>
<p>Debug flag. If it is 1, it will be in debug mode.</p>
<pre><code class="lang-C++"><span class="hljs-comment">//  debug</span>
<span class="hljs-keyword">int</span> debug = <span class="hljs-number">0</span>;
</code></pre>
<p>NTP and time zone declaration.</p>
<pre><code class="lang-C++"><span class="hljs-comment">//ntp</span>
NTPClient ntpclient;
TimeZone localtimezone = { <span class="hljs-number">9</span>*<span class="hljs-number">60</span>*<span class="hljs-number">60</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&quot;+09:00&quot;</span> };
</code></pre>
<p>Declaration of FIAPUploadAgent and setting of element.
FIAPUploadAgent combines the first element of the element structure at the end of the prefix, send the character string set for the second element. Since it is not necessary to regenerate the buffer of the character string to be sent every time, declare it globally. To increase the number of points you need to send, add an element.</p>
<pre><code class="lang-C++"><span class="hljs-comment">//fiap</span>
FIAPUploadAgent fiap_upload_agent;
<span class="hljs-keyword">char</span> temperature_str[<span class="hljs-number">16</span>];
<span class="hljs-keyword">struct</span> fiap_element fiap_elements [] = {
  { <span class="hljs-string">&quot;Temperature&quot;</span>, temperature_str, <span class="hljs-number">0</span>, &amp;localtimezone, },
};
</code></pre>
<p>Declaration of ADT74x0</p>
<pre><code class="lang-C++"><span class="hljs-comment">//sensor</span>
ADT74x0 tempsensor;
</code></pre>
<p>It is executed when debug switching function, upon reception of <code>debug</code>, <code>nodebug</code> from SerialCLI.</p>
<pre><code class="lang-C++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">enable_debug</span><span class="hljs-params">()</span>
</span>{
  debug = <span class="hljs-number">1</span>;
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">disable_debug</span><span class="hljs-params">()</span>
</span>{
  debug = <span class="hljs-number">0</span>;
}
</code></pre>
<h4 id="setup-function">setup function</h4>
<p>setup function runs only once at startup.</p>
<p>Register setting items and debug commands to Serial CLI.</p>
<pre><code class="lang-C++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">int</span> ret;
  commandline.add_entry(&amp;mac);

  commandline.add_entry(&amp;dhcp);
  commandline.add_entry(&amp;ip);
  commandline.add_entry(&amp;gw);
  commandline.add_entry(&amp;sm);
  commandline.add_entry(&amp;dns_server);

  commandline.add_entry(&amp;ntp);

  commandline.add_entry(&amp;host);
  commandline.add_entry(&amp;port);
  commandline.add_entry(&amp;path);
  commandline.add_entry(&amp;prefix);

  commandline.add_command(<span class="hljs-string">&quot;debug&quot;</span>, enable_debug);
  commandline.add_command(<span class="hljs-string">&quot;nodebug&quot;</span>, disable_debug);

  commandline.begin(<span class="hljs-number">9600</span>, <span class="hljs-string">&quot;ADT74x0 Gateway&quot;</span>);
</code></pre>
<p>In this case, we will use DHCP flag to distinguish whether DHCP is used or not. From that point forward, please refer to how to use Arduino&apos;s <a href="https://www.arduino.cc/en/Reference/Ethernet" target="_blank">Ethernet library</a>.</p>
<pre><code class="lang-C++">  <span class="hljs-comment">// ethernet &amp; ip connection</span>
  <span class="hljs-keyword">if</span>(dhcp.get_val() == <span class="hljs-number">1</span>){
    ret = Ethernet.begin(mac.get_val());
    <span class="hljs-keyword">if</span>(ret == <span class="hljs-number">0</span>) {
      restart(<span class="hljs-string">&quot;Failed to configure Ethernet using DHCP&quot;</span>, <span class="hljs-number">10</span>);
    }
  }<span class="hljs-keyword">else</span>{
    Ethernet.begin(mac.get_val(), ip.get_val(), dns_server.get_val(), gw.get_val(), sm.get_val());
  }
</code></pre>
<p>Acquire the time with NTP. After acquiring, set it to the Time library&#xFF0E;</p>
<pre><code class="lang-C++">  <span class="hljs-comment">// fetch time</span>
  <span class="hljs-keyword">uint32_t</span> unix_time;
  ntpclient.begin();
  ret = ntpclient.getTime(ntp.get_val(), &amp;unix_time);
  <span class="hljs-keyword">if</span>(ret &lt; <span class="hljs-number">0</span>){
    restart(<span class="hljs-string">&quot;Failed to configure time using NTP&quot;</span>, <span class="hljs-number">10</span>);
  }
  setTime(unix_time);
</code></pre>
<p>FIAPUploadAgent Initialization</p>
<pre><code class="lang-C++">  <span class="hljs-comment">// fiap</span>
  fiap_upload_agent.begin(host.get_val(), path.get_val(), port.get_val(), prefix.get_val());
</code></pre>
<p>Sensor Initialization</p>
<pre><code class="lang-C++">  <span class="hljs-comment">// sensor</span>
  Wire.begin();
  tempsensor.begin(<span class="hljs-number">0x48</span>);
}
</code></pre>
<h3 id="loop-function">loop function</h3>
<p>loop function is executed in an infinite loop.</p>
<p><code>epoch</code> and <code>old_epoch</code> are <code>static</code>. Normally, local variables are reset for each function call&#xFF0C;but if <code>static</code> is attached, the previous value is memorized.<code>commandline.process ()</code> will process the stored commands.</p>
<pre><code class="lang-C++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> old_epoch = <span class="hljs-number">0</span>, epoch;

  commandline.process();
</code></pre>
<p>Update <code>epoch</code>.</p>
<pre><code class="lang-C++">  epoch = now();
</code></pre>
<p>When using DHCP, it is necessary to update the address information on a regular basis.</p>
<pre><code class="lang-C++">  <span class="hljs-keyword">if</span>(dhcp.get_val() == <span class="hljs-number">1</span>){
    Ethernet.maintain();
  }
</code></pre>
<p>With this conditional expression, this <code>if</code> is executed only once per second.</p>
<pre><code class="lang-C++">  <span class="hljs-keyword">if</span>(epoch != old_epoch){
</code></pre>
<p>Temperature is fetched from ADT74x0 and written to transmission buffer. Since the temperature is <code>float</code>, it must be string.Usually we use <code>sprintf</code>, but Arduino<code>sprintf</code> is not compatible with <code>float</code>, so use<code>dtostrf</code>.For <code>dtostrf</code> refer to Arduino fundamentals&#xFF0C;<a href="../../3-arduino-fundamentals/dtostrf/">Make float decimal point to string (dtostrf)</a>&#xFF0E;
    dtostrf(tempsensor.readTemperature(), -1, 2, temperature_str);
    debug_msg(temperature_str);</p>
<pre><code>
`epoch` contains the current second. Since it takes between 0 and 59, this condition holds at 0 seconds per minute. In other words, upload processing can be executed once a minute.
```C++
    if(epoch % 60 == 0){
      debug_msg(&quot;uploading...&quot;);
</code></pre><p>It is an upload process. Send everything registered in the <code>fiap_elements</code> array as an element.<code>fiap_elements [i] .time = epoch;</code> sets the time of the value to be written to the current time.Note that using <code>now ()</code> instead of <code>epoch</code> may cause a deviation occurs in seconds.By the way, <code>sizeof (array) / sizeof (array [0])</code> is an idiom that can get the number of elements of an array.</p>
<pre><code class="lang-C++">      <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">sizeof</span>(fiap_elements)/<span class="hljs-keyword">sizeof</span>(fiap_elements[<span class="hljs-number">0</span>]); i++){
        fiap_elements[i].time = epoch;
      }
      <span class="hljs-keyword">int</span> ret = fiap_upload_agent.post(fiap_elements, <span class="hljs-keyword">sizeof</span>(fiap_elements)/<span class="hljs-keyword">sizeof</span>(fiap_elements[<span class="hljs-number">0</span>]));
      <span class="hljs-keyword">if</span>(ret == <span class="hljs-number">0</span>){
        debug_msg(<span class="hljs-string">&quot;done&quot;</span>);
      }<span class="hljs-keyword">else</span>{
        debug_msg(<span class="hljs-string">&quot;failed&quot;</span>);
        Serial.println(ret);
      }
    }
</code></pre>
<p>Lastly update <code>old_epoch</code>.</p>
<pre><code class="lang-C++">  }

  old_epoch = epoch;
}
</code></pre>
<h3 id="various-utility-functions">Various utility functions</h3>
<p>Output debug messages.</p>
<pre><code class="lang-C++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">debug_msg</span><span class="hljs-params">(String msg)</span>
</span>{
  <span class="hljs-keyword">if</span>(debug == <span class="hljs-number">1</span>){
    Serial.print(<span class="hljs-string">&quot;[&quot;</span>);
    print_time();
    Serial.print(<span class="hljs-string">&quot;]&quot;</span>);
    Serial.println(msg);
  }
}
</code></pre>
<p>Output time with debug messages.</p>
<pre><code class="lang-C++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">print_time</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">char</span> print_time_buf[<span class="hljs-number">32</span>];
  TimeElements* tm;
  tm = localtime();
  <span class="hljs-built_in">sprintf</span>(print_time_buf, <span class="hljs-string">&quot;%04d/%02d/%02d %02d:%02d:%02d&quot;</span>,
      tm-&gt;Year + <span class="hljs-number">1970</span>, tm-&gt;Month, tm-&gt;Day, tm-&gt;Hour, tm-&gt;Minute, tm-&gt;Second);
  Serial.print(print_time_buf);
}
</code></pre>
<p>Restart function.</p>
<pre><code class="lang-C++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">restart</span><span class="hljs-params">(String msg, <span class="hljs-keyword">int</span> restart_minutes)</span>
</span>{
  Serial.println(msg);
  Serial.print(<span class="hljs-string">&quot;This system will restart after &quot;</span>);
  Serial.print(restart_minutes);
  Serial.print(<span class="hljs-string">&quot;minutes.&quot;</span>);

  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> start_ms = millis();
  <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>){
    commandline.process();
    <span class="hljs-keyword">if</span>(millis() - start_ms &gt; restart_minutes*<span class="hljs-number">60U</span>L*<span class="hljs-number">1000U</span>L){
      commandline.reboot();
    }
  }
}
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../getting-started/" class="navigation navigation-prev " aria-label="Previous page: Upload from M2M gateway">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../extending-temp-upload/" class="navigation navigation-next " aria-label="Next page: Extend temp_upload">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Description temp_upload","level":"1.5.3","depth":2,"next":{"title":"Extend temp_upload","level":"1.5.4","depth":2,"path":"4-ieee1888/extending-temp-upload/README.md","ref":"4-ieee1888/extending-temp-upload/README.md","articles":[]},"previous":{"title":"Upload from M2M gateway","level":"1.5.2","depth":2,"path":"4-ieee1888/getting-started/README.md","ref":"4-ieee1888/getting-started/README.md","articles":[]},"dir":"ltr"},"config":{"plugins":["ga"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"ga":{"configuration":"auto","token":"UA-48046698-3"},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"language":"en","gitbook":"*"},"file":{"path":"4-ieee1888/code-reading/README.md","mtime":"2017-12-05T15:26:20.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2017-12-06T09:33:43.421Z"},"basePath":"../..","book":{"language":"en"}});
        });
    </script>
</div>

        
    <script src="../../../gitbook/gitbook.js"></script>
    <script src="../../../gitbook/theme.js"></script>
    
        
        <script src="../../../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

